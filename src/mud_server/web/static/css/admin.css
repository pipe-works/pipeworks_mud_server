/* ═══════════════════════════════════════════════════════════════════════════
   admin.css
   ─────────────────────────────────────────────────────────────────────────
   Admin dashboard styles.  Imports AFTER pipe-works-base.css which provides
   the design-token layer, reset, and shared component primitives.

   This file contains ONLY admin-specific layout, components, and overrides.
   ═══════════════════════════════════════════════════════════════════════════ */


/* ── Admin-specific tokens ────────────────────────────────────────────── */
:root {
  --layout-max: 1600px;
  --layout-pad: 32px;
}


/* ═══════════════════════════════════════════════════════════════════════════
   1. APP SHELL & LAYOUT
   ═══════════════════════════════════════════════════════════════════════════ */

.app-shell {
  min-height: 100vh;
  width: 100%;
  display: block;
  background: var(--col-bg);
}

.layout {
  display: grid;
  grid-template-columns: 280px minmax(0, 1fr);
  min-height: 100vh;
  width: 100%;
  background: var(--col-bg);
}

/* ── Sidebar ──────────────────────────────────────────────────────────── */

.sidebar {
  background: var(--col-surface);
  border-right: 1px solid var(--col-border);
  padding: var(--sp-6) var(--sp-4);
  position: sticky;
  top: 0;
  align-self: start;
  height: 100vh;
  display: flex;
  flex-direction: column;
  gap: 2rem;
  overflow-y: auto;
}

.brand {
  font-family: var(--font-mono);
  font-weight: 700;
  letter-spacing: 0.02em;
  font-size: var(--text-lg);
  color: var(--col-accent);
}

.nav {
  display: grid;
  gap: 1.2rem;
}

.nav-group {
  display: grid;
  gap: var(--sp-2);
  margin-bottom: var(--sp-2);
}

.nav-group-title {
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--col-text-muted);
}

.nav-link {
  text-decoration: none;
  color: var(--col-text);
  padding: var(--sp-2) var(--sp-3);
  border-radius: var(--radius-sm);
  font-family: var(--font-mono);
  font-size: var(--text-sm);
  display: flex;
  align-items: center;
  gap: var(--sp-2);
  transition: background var(--transition-fast), color var(--transition-fast);
}

.nav-link:hover {
  background: color-mix(in srgb, var(--col-accent) 8%, transparent);
}

.nav-link.is-active {
  background: var(--col-accent);
  color: var(--col-button-text);
}

/* ── Main content area ────────────────────────────────────────────────── */

.main {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  background: var(--col-bg);
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: var(--sp-4);
  padding: var(--sp-3) var(--layout-pad);
  border-bottom: 1px solid var(--col-border);
  background: var(--col-surface);
  position: sticky;
  top: 0;
  z-index: 5;
}

.header-title {
  display: grid;
  gap: var(--sp-1);
}

.header-title h1 {
  margin: 0;
  font-size: var(--text-xl);
}

.header-title span {
  color: var(--col-text-muted);
  font-size: var(--text-sm);
}

.content {
  padding: var(--sp-6) var(--layout-pad) var(--sp-6);
  width: 100%;
  max-width: none;
  margin: 0;
  display: grid;
  gap: var(--sp-6);
}


/* ═══════════════════════════════════════════════════════════════════════════
   2. AUTH SHELL (login page)
   ═══════════════════════════════════════════════════════════════════════════ */

.auth-shell {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  padding: var(--sp-6);
}

.auth-panel {
  padding: var(--sp-4) var(--sp-6);
  border-radius: var(--radius-lg);
  border: 1px solid var(--col-border);
  background: var(--col-surface-2);
  width: min(100%, 560px);
}

.auth-panel.wide {
  width: 100%;
  max-width: none;
}

.error {
  margin-top: var(--sp-4);
  color: var(--col-err);
}


/* ═══════════════════════════════════════════════════════════════════════════
   3. PAGE STRUCTURE
   ═══════════════════════════════════════════════════════════════════════════ */

.page {
  display: grid;
  gap: var(--sp-6);
  grid-template-columns: 1fr;
  justify-items: stretch;
}

.page-header {
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  gap: var(--sp-4);
}

.page-header h2 {
  margin: 0;
  font-size: var(--text-xl);
}

.page-header p {
  margin: var(--sp-1) 0 0;
}

.actions {
  display: flex;
  flex-wrap: wrap;
  gap: var(--sp-2);
}


/* ═══════════════════════════════════════════════════════════════════════════
   4. SPLIT LAYOUTS
   ═══════════════════════════════════════════════════════════════════════════ */

.split-layout {
  display: grid;
  grid-template-columns: minmax(0, 2.8fr) minmax(300px, 1fr);
  gap: var(--sp-6);
  align-items: start;
}

.users-split {
  grid-template-columns: minmax(0, 3.168fr) minmax(520px, 1.885fr);
}

.users-split > * {
  min-width: 0;
}

.users-split .detail-panel {
  min-width: 0;
  justify-self: stretch;
}

.users-left {
  display: grid;
  gap: var(--sp-4);
  min-width: 0;
  overflow-x: hidden;
}

.dashboard-split {
  grid-template-columns: minmax(0, 2fr) minmax(380px, 1fr);
}

.dashboard-left,
.dashboard-right {
  min-width: 0;
}

.users-bottom-row {
  display: grid;
  grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
  gap: var(--sp-4);
  align-items: start;
}


/* ═══════════════════════════════════════════════════════════════════════════
   5. CARDS & PANELS (admin overrides)
   ═══════════════════════════════════════════════════════════════════════════ */

/*
 * Override base CSS .card to tighten padding for admin dashboard use.
 * Base .card provides border, radius-lg, surface-2 bg, and inset shadow.
 */
.card {
  padding: var(--sp-4);
}

.card.table-card {
  padding: var(--sp-3) var(--sp-4);
}

.detail-panel {
  display: grid;
  gap: var(--sp-4);
}

.detail-card {
  padding: var(--sp-3);
  border-radius: var(--radius-md);
  border: 1px solid var(--col-border);
  background: var(--col-surface);
}

.detail-card h3 {
  margin: 0 0 var(--sp-3);
}

.kpi-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: var(--sp-4);
}

.kpi-card {
  padding: var(--sp-3);
  border-radius: var(--radius-md);
  border: 1px solid var(--col-border);
  background: var(--col-surface);
}

.stat-label {
  color: var(--col-text-muted);
  font-size: var(--text-sm);
}

.stat-value {
  font-size: var(--text-xl);
  font-weight: 700;
}

.users-placeholder-card {
  min-height: 220px;
}


/* ═══════════════════════════════════════════════════════════════════════════
   6. DETAIL VIEWS
   ═══════════════════════════════════════════════════════════════════════════ */

.detail-form {
  display: grid;
  gap: var(--sp-2);
}

.detail-form label {
  display: grid;
  gap: var(--sp-1);
  font-size: var(--text-sm);
  font-weight: 600;
}

.detail-help {
  margin: var(--sp-2) 0 0;
  font-size: var(--text-sm);
}

.detail-code {
  margin: var(--sp-2) 0 0;
  padding: var(--sp-2);
  border-radius: var(--radius-md);
  border: 1px solid var(--col-border);
  background: var(--col-code-bg);
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  white-space: pre-wrap;
  word-break: break-word;
}

.detail-list {
  display: grid;
  gap: var(--sp-2);
  margin: 0;
}

.detail-list div {
  display: grid;
  grid-template-columns: 120px 1fr;
  gap: var(--sp-2);
}

.detail-list dt {
  color: var(--col-text-muted);
  font-size: var(--text-sm);
}

.detail-list dd {
  margin: 0;
  font-weight: 600;
}

.detail-row {
  display: flex;
  justify-content: space-between;
  gap: var(--sp-4);
  padding: var(--sp-2) 0;
  border-bottom: 1px solid var(--col-border);
}

.detail-row:last-child {
  border-bottom: none;
}

.detail-title {
  font-weight: 600;
}

.detail-sub {
  color: var(--col-text-muted);
  font-size: var(--text-sm);
}

.detail-meta {
  color: var(--col-text-muted);
  font-size: var(--text-sm);
}


/* ═══════════════════════════════════════════════════════════════════════════
   7. TABLES
   ═══════════════════════════════════════════════════════════════════════════ */

.table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  margin-top: var(--sp-3);
  font-size: var(--text-sm);
}

.table th,
.table td {
  text-align: left;
  padding: var(--sp-2) var(--sp-3);
  border-bottom: 1px solid var(--col-border);
}

.table thead th {
  background: var(--col-surface);
  color: var(--col-text-muted);
  font-size: var(--text-xs);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  position: sticky;
  top: 0;
  z-index: 1;
}

.table th.sortable {
  cursor: pointer;
  user-select: none;
}

.table th.sortable:hover {
  color: var(--col-text);
}

.sort-indicator {
  font-size: var(--text-xs);
  margin-left: var(--sp-1);
  opacity: 0.6;
}

.table tbody tr:nth-child(even) {
  background: color-mix(in srgb, var(--col-text) 3%, transparent);
}

.table tbody tr.is-selectable {
  cursor: pointer;
}

.table tbody tr.is-selected {
  background: color-mix(in srgb, var(--col-accent) 16%, transparent);
  box-shadow: inset 3px 0 0 var(--col-accent);
}

.table tbody tr:hover {
  background: color-mix(in srgb, var(--col-accent) 8%, transparent);
}

.table tbody tr.is-in-world {
  background: color-mix(in srgb, var(--col-ok) 9%, transparent);
}

.table tbody tr.is-selected:hover {
  background: color-mix(in srgb, var(--col-accent) 20%, transparent);
}

.table-wrap {
  width: 100%;
  overflow-x: auto;
  border-radius: var(--radius-md);
  border: 1px solid var(--col-border);
}

.table-toolbar {
  display: flex;
  flex-wrap: wrap;
  gap: var(--sp-3);
  padding-bottom: var(--sp-3);
  align-items: flex-end;
  justify-content: space-between;
}

.table-search {
  display: grid;
  gap: var(--sp-1);
  font-size: var(--text-xs);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--col-text-muted);
  min-width: 220px;
}

.table-toggle {
  display: inline-flex;
  align-items: center;
  gap: var(--sp-2);
  font-size: var(--text-sm);
  color: var(--col-text-muted);
}

.table-toggle input {
  width: 16px;
  height: 16px;
  accent-color: var(--col-accent);
}

.table-empty {
  text-align: center;
  color: var(--col-text-muted);
  font-style: italic;
  padding: var(--sp-3) var(--sp-2);
}

.table-refresh-note {
  font-size: var(--text-xs);
  color: var(--col-text-muted);
  letter-spacing: 0.02em;
}


/* ═══════════════════════════════════════════════════════════════════════════
   8. USERS TABLE SPECIFICS
   ═══════════════════════════════════════════════════════════════════════════ */

.users-table-card {
  display: flex;
  flex-direction: column;
  height: 730px;
  min-height: 0;
  max-width: 100%;
  overflow: hidden;
}

.users-table-card .table-wrap {
  flex: 1;
  min-height: 0;
  overflow: auto;
  max-width: 100%;
}

.users-table-card .table {
  margin-top: var(--sp-2);
  min-width: 100%;
  width: max-content;
}

.users-table-card .table th:nth-child(3),
.users-table-card .table td:nth-child(3) {
  min-width: 150px;
}

.users-table-card .table th:nth-child(5),
.users-table-card .table td:nth-child(5) {
  min-width: 180px;
}

.users-tombstoned-card .table-wrap {
  max-height: 260px;
  overflow: auto;
}

.users-detail-card {
  height: 730px;
  width: 100%;
  min-width: 0;
}

.users-detail-card .tab-panel {
  overflow-x: hidden;
}

.users-detail-card .detail-list dd,
.users-detail-card .axis-state-summary dd,
.users-detail-card .axis-event-values,
.users-detail-card .axis-event-change {
  overflow-wrap: anywhere;
  word-break: break-word;
}

.users-detail-card .detail-code {
  white-space: pre-wrap;
  overflow-wrap: anywhere;
}


/* ═══════════════════════════════════════════════════════════════════════════
   9. DASHBOARD SPECIFICS
   ═══════════════════════════════════════════════════════════════════════════ */

.dashboard-table-card {
  display: flex;
  flex-direction: column;
  min-height: 0;
  height: 730px;
}

.dashboard-table-card .table-wrap {
  flex: 1;
  min-height: 0;
  overflow: auto;
}

.dashboard-detail-card {
  height: 730px;
  display: flex;
  flex-direction: column;
  gap: var(--sp-4);
  overflow: auto;
}

.dashboard-scroll-region {
  border: 1px solid var(--col-border);
  border-radius: var(--radius-md);
  padding: var(--sp-1) var(--sp-3);
  overflow: auto;
}

.dashboard-toolbar {
  justify-content: flex-start;
  gap: var(--sp-3);
}

.dashboard-select-inline {
  min-width: 170px;
}


/* ═══════════════════════════════════════════════════════════════════════════
   10. TABS
   ═══════════════════════════════════════════════════════════════════════════ */

.tab-card {
  display: flex;
  flex-direction: column;
  gap: var(--sp-3);
}

.tab-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--sp-3);
  flex-wrap: wrap;
}

.tab-header h3 {
  margin: 0;
}

.tab-buttons {
  display: inline-flex;
  gap: var(--sp-1);
  flex-wrap: nowrap;
}

.tab-button {
  border: 1px solid var(--col-border);
  background: transparent;
  color: var(--col-text-muted);
  padding: var(--sp-1) var(--sp-2);
  border-radius: var(--radius-sm);
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  cursor: pointer;
  transition: border-color var(--transition-fast), color var(--transition-fast),
              background var(--transition-fast);
}

.tab-button.is-active {
  border-color: var(--col-accent);
  color: var(--col-accent);
  background: var(--col-accent-glow);
}

.tab-panel h4 {
  margin: 0 0 var(--sp-2);
  font-size: var(--text-sm);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--col-text-muted);
}

.tab-panel {
  flex: 1;
  overflow: auto;
}


/* ═══════════════════════════════════════════════════════════════════════════
   11. TAGS & STATUS
   ═══════════════════════════════════════════════════════════════════════════ */

.tag-list {
  display: flex;
  flex-wrap: wrap;
  gap: var(--sp-2);
}

.tag {
  padding: var(--sp-1) var(--sp-2);
  border-radius: var(--radius-sm);
  border: 1px solid var(--col-border);
  background: var(--col-surface-2);
  font-size: var(--text-xs);
}

.status-stack {
  display: flex;
  flex-direction: column;
  gap: var(--sp-1);
}

.status-world-list {
  display: flex;
  flex-wrap: wrap;
  gap: var(--sp-1);
}

.status-world-chip {
  padding: 1px var(--sp-1);
  border-radius: var(--radius-sm);
  border: 1px dashed var(--col-border);
  background: var(--col-surface-2);
  color: var(--col-text-muted);
  font-size: var(--text-xs);
  line-height: 1;
}


/* ═══════════════════════════════════════════════════════════════════════════
   12. CHARACTER MANAGEMENT
   ═══════════════════════════════════════════════════════════════════════════ */

.character-actions {
  display: inline-flex;
  flex-wrap: wrap;
  gap: var(--sp-2);
  justify-content: flex-end;
}

.create-character-panel {
  display: grid;
  gap: var(--sp-3);
}

.create-character-panel .detail-form {
  margin-top: var(--sp-1);
}

.create-character-panel input[readonly] {
  opacity: 0.85;
  cursor: not-allowed;
}

.detail-row-character {
  align-items: center;
}

.detail-row-character .detail-meta {
  margin-top: var(--sp-1);
}


/* ═══════════════════════════════════════════════════════════════════════════
   13. AXIS STATE & EVENTS
   ═══════════════════════════════════════════════════════════════════════════ */

.axis-state-select select {
  width: 100%;
}

/* Force readable text inside native <option> elements in dark mode.
   Browsers often ignore inherited color on option elements. */
.select option {
  background: var(--col-surface-2);
  color: var(--col-text);
}

.axis-score-list {
  margin-bottom: var(--sp-2);
}

.axis-event-list {
  display: grid;
  gap: var(--sp-3);
  margin-top: var(--sp-2);
}

.axis-event {
  padding: var(--sp-2);
  border-radius: var(--radius-md);
  border: 1px solid var(--col-border);
  background: var(--col-surface-2);
  display: grid;
  gap: var(--sp-2);
}

.axis-event-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: var(--sp-3);
}

.axis-event-title {
  font-weight: 600;
}

.axis-event-kind {
  margin-top: 1px;
  font-size: var(--text-xs);
  text-transform: uppercase;
  letter-spacing: 0.06em;
  color: var(--col-text-muted);
}

.axis-event-summary {
  margin-top: var(--sp-1);
  font-size: var(--text-sm);
  color: var(--col-text);
}

.axis-event-sub {
  font-size: var(--text-sm);
  color: var(--col-text-muted);
}

.axis-event-world {
  font-size: var(--text-xs);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--col-text-muted);
}

.axis-event-deltas {
  display: grid;
  gap: var(--sp-1);
}

.axis-event-delta {
  display: flex;
  justify-content: space-between;
  gap: var(--sp-3);
  font-size: var(--text-sm);
}

.axis-event-axis {
  font-weight: 600;
}

.axis-event-values {
  color: var(--col-text-muted);
}

.axis-event-change {
  font-weight: 600;
}

.axis-event-tags {
  margin-top: var(--sp-1);
}


/* ═══════════════════════════════════════════════════════════════════════════
   14. SCHEMA VISUALIZATION
   ═══════════════════════════════════════════════════════════════════════════ */

.schema-layout {
  display: grid;
  grid-template-columns: minmax(0, 1fr) minmax(0, 1.6fr);
  gap: var(--sp-6);
  align-items: start;
}

.schema-map {
  border-radius: var(--radius-lg);
  border: 1px solid var(--col-border);
  background: var(--col-surface);
  padding: var(--sp-3);
  overflow: auto;
}

.schema-svg {
  width: 100%;
  min-height: 320px;
}

.schema-link {
  stroke: var(--col-accent);
  stroke-width: 2;
  fill: none;
  opacity: 0.5;
}

.schema-node rect {
  fill: var(--col-surface-2);
  stroke: var(--col-border);
  stroke-width: 1.5;
}

.schema-node-title {
  font-size: var(--text-sm);
  font-weight: 600;
  fill: var(--col-text);
}

.schema-node-meta {
  font-size: var(--text-xs);
  fill: var(--col-text-muted);
}

.schema-relations {
  list-style: none;
  padding: 0;
  margin: var(--sp-3) 0 0;
  display: grid;
  gap: var(--sp-3);
}

.schema-relations li {
  padding: var(--sp-2) var(--sp-3);
  border-radius: var(--radius-md);
  border: 1px solid var(--col-border);
  background: var(--col-surface-2);
  display: grid;
  gap: var(--sp-1);
}

.relation-main {
  display: flex;
  flex-wrap: wrap;
  gap: var(--sp-1);
  align-items: center;
}

.relation-source,
.relation-target {
  font-weight: 600;
}

.relation-arrow {
  color: var(--col-text-muted);
}

.relation-meta {
  color: var(--col-text-muted);
  font-size: var(--text-sm);
}


/* ═══════════════════════════════════════════════════════════════════════════
   15. TOAST NOTIFICATIONS
   ═══════════════════════════════════════════════════════════════════════════ */

.toast-container {
  position: fixed;
  right: var(--sp-4);
  top: var(--sp-4);
  display: grid;
  gap: var(--sp-2);
  z-index: 1000;
}

.toast {
  padding: var(--sp-2) var(--sp-3);
  border-radius: var(--radius-md);
  background: var(--col-surface);
  color: var(--col-text);
  border: 1px solid var(--col-border);
  transition: opacity var(--transition-med), transform var(--transition-med);
}

.toast-info {
  border-left: 4px solid var(--col-accent);
}

.toast-success {
  border-left: 4px solid var(--col-ok);
}

.toast-error {
  border-left: 4px solid var(--col-err);
}

.toast-hide {
  opacity: 0;
  transform: translateY(-6px);
}


/* ═══════════════════════════════════════════════════════════════════════════
   16. UTILITIES
   ═══════════════════════════════════════════════════════════════════════════ */

.noscript {
  padding: var(--sp-6);
  text-align: center;
}


/* ═══════════════════════════════════════════════════════════════════════════
   17. RESPONSIVE
   ═══════════════════════════════════════════════════════════════════════════ */

@media (max-width: 1100px) {
  .split-layout {
    grid-template-columns: 1fr;
  }

  .schema-layout {
    grid-template-columns: 1fr;
  }

  .users-table-card {
    height: auto;
  }

  .users-bottom-row {
    grid-template-columns: 1fr;
  }

  .tab-header {
    align-items: flex-start;
  }

  .users-split {
    grid-template-columns: 1fr;
  }

  .dashboard-split {
    grid-template-columns: 1fr;
  }

  .users-split .detail-panel {
    min-width: 0;
  }

  .users-detail-card {
    height: auto;
    min-width: 0;
  }

  .dashboard-table-card,
  .dashboard-detail-card {
    height: auto;
  }
}

@media (max-width: 1080px) {
  .layout {
    grid-template-columns: 1fr;
  }

  .sidebar {
    border-right: none;
    border-bottom: 1px solid var(--col-border);
    height: auto;
    position: relative;
  }

  .content {
    padding: var(--sp-4) var(--sp-3) var(--sp-6);
    max-width: none;
  }
}
